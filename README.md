QR PhotoShare
=============

Самостоятельно развёртываемый сервис обмена фотографиями для мероприятий. Гости сканируют QR-код, загружают снимки, а организатор модерирует и показывает их через админ-панель и публичные галереи.

Структура проекта
-----------------
- `backend/` – API на Express + SQLite: управление событиями, загрузками, модерацией, авторизацией.
- `frontend/` – статические HTML/JS/CSS: админ-панель, страницы загрузки, live-wall, галерея.
- `backend/uploads/` – хранилище фотографий по событиям (создаётся автоматически).
- `backend/db/qr_photoshare.db` – база данных SQLite (создаётся при первом запуске).

Ключевые возможности
--------------------
- Авторизация администратора через JWT с настраиваемыми логином и паролем.
- Создание событий, генерация QR-кодов и ссылок для загрузки.
- Загрузка фотографий по событиям с опциональной модерацией.
- Счётчик лайков, live-wall, выгрузка архива фотографий.
- Настройки брендирования (цвета и фон) на уровне события.

Требования
----------
- Node.js 18+ и npm.
- Доступ на запись к `backend/uploads/` и файлу базы данных.
- Опционально: менеджер процессов (PM2/systemd) и обратный прокси (Nginx) для продакшена.

Конфигурация
------------
Создайте файл `backend/.env`, используя шаблон ниже. Значения, отмеченные `*`, обязательно задайте свои:

```
PORT=5000
FRONTEND_URL=https://ваш-домен-frontend
ADMIN_USER=admin            # * задайте логин администратора
ADMIN_PASS=strong_password  # * задайте пароль администратора
JWT_SECRET=change_me        # * секрет для подписи JWT
```

- `FRONTEND_URL` используется при формировании QR-ссылок для загрузки.
- `PORT` определяет порт бэкенда (по умолчанию 5000).
- Проверьте, что `frontend/js/config.js` указывает на правильный адрес API (`https://ваш-домен-backend/api` в продакшене).

Подготовка
----------
1. Установите зависимости бэкенда:
   ```
   cd backend
   npm install
   ```
2. Убедитесь, что папка `uploads/` существует и доступна на запись (при запуске создаётся автоматически).
3. Разместите `.env` в каталоге `backend/`.

Локальная разработка
--------------------
- Запустите API с автоперезапуском:
  ```
  cd backend
  npm run dev
  ```
- Раздайте фронтенд статически (например, `npx http-server frontend`) или откройте HTML-файлы напрямую, указав в `frontend/js/config.js` `http://localhost:5000/api`.

Продакшен
---------
1. Обновите `frontend/js/config.js`, чтобы `API_CONFIG.baseUrl` указывал на боевой бэкенд, затем задеплойте статические файлы.
2. Запустите бэкенд через менеджер процессов (пример с PM2):
   ```
   cd backend
   pm2 start server.js --name qr-backend
   pm2 save
   ```
3. Настройте обратный прокси (Nginx/Apache) для HTTPS и статического фронтенда.
4. Регулярно делайте бэкапы `backend/uploads/` и `backend/db/qr_photoshare.db`.

API
---
- `POST /api/auth/login` – авторизация администратора (возвращает JWT).
- `POST /api/events` – создание события (требуется авторизация).
- `GET /api/events/:id` и другие – управление событиями (см. файлы маршрутов).
- `POST /api/photos/upload?event=<id>` – публичная загрузка фотографий (используется в QR-ссылках).
- `GET /api/photos/event/:eventId` – список одобренных фотографий для галереи/live-wall.
- `GET /api/photos/event/:eventId/pending` – очередь модерации (требуется авторизация).
- `POST /api/photos/moderate/approve|reject` – подтверждение или отклонение фото.
- `GET /api/photos/download?event=<id>` – скачивание архива фото события.

Фронтенд
--------
- `frontend/admin.html` – вход в админку.
- `frontend/js/admin.js` – логика админской SPA.
- `frontend/gallery.html` – объединённая страница загрузки и галереи (выбор файлов, подтверждение обработки, лайки, сортировка).
- `frontend/live-wall.html` – live-wall с автоподгрузкой одобренных фото.

Заметки по разработке
---------------------
- Статические ресурсы и стили лежат в `frontend/styles/`.
- В `backend/routes/events.js` запасной URL — `http://localhost:3000`; в продакшене используйте `FRONTEND_URL`.
- `frontend/js/config.js` задаёт адрес API для всех фронтенд-скриптов.
- Если требуется сложная миграция БД, планируйте отдельные скрипты; текущие ALTER-операции запускаются автоматически.

Лицензия
--------
Укажите условия лицензии, если необходимо.

